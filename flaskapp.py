from flask import Flask, render_template, redirect, request, url_for,send_file
import pandas as pd
import json
import plotly
import plotly.express as px
from plotly import io
import plotly.graph_objects as go
from chart_functions import render_charts
import nsepy
import datetime
from fundamental import getfundamental
dt=datetime.datetime.today()

app = Flask(__name__)
nifty_companies=['3M India Limited', 'Aarti Drugs Limited', 'Aarti Industries Limited', 'Aavas Financiers Limited', 'ABB India Limited', 'Abbott India Limited', 'Aditya Birla Capital Limited', 'Aditya Birla Fashion and Retail Limited', 'ACC Limited', 'Adani Enterprises Limited', 'Adani Green Energy Limited', 'Adani Ports and Special Economic Zone Limited', 'Adani Transmission Limited', 'Advanced Enzyme Technologies Limited', 'Aegis Logistics Limited', 'Affle (India) Limited', 'AIA Engineering Limited', 'Ajanta Pharma Limited', 'Akzo Nobel India Limited', 'Alembic Limited', 'Alkem Laboratories Limited', 'Alkyl Amines Chemicals Limited', 'Alok Industries Limited', 'Amara Raja Batteries Limited', 'Amber Enterprises India Limited', 'Ambuja Cements Limited', 'Angel Broking Limited', 'APL Apollo Tubes Limited', 'Alembic Pharmaceuticals Limited', 'Apollo Hospitals Enterprise Limited', 'Apollo Tyres Limited', 'Asahi India Glass Limited', 'Ashoka Buildcon Limited', 'Ashok Leyland Limited', 'Asian Paints Limited', 'Aster DM Healthcare Limited', 'Astral Poly Technik Limited', 'AstraZeneca Pharma India Limited', 'Adani Total Gas Limited', 'Atul Limited', 'AU Small Finance Bank Limited', 'Aurobindo Pharma Limited', 'Avanti Feeds Limited', 'Axis Bank Limited', 'Bajaj Auto Limited', 'Bajaj Consumer Care Limited', 'Bajaj Electricals Limited', 'Bajaj Finserv Limited', 'Bajaj Holdings & Investment Limited', 'Bajaj Finance Limited', 'Balaji Amines Limited', 'Balkrishna Industries Limited', 'Balmer Lawrie & Company Limited', 'Balrampur Chini Mills Limited', 'Bandhan Bank Limited', 'Bank of Baroda', 'Bank of India', 'BASF India Limited', 'Bata India Limited', 'Bayer Cropscience Limited', 'Bombay Burmah Trading Corporation Limited', 'Bharat Dynamics Limited', 'Bharat Electronics Limited', 'BEML Limited', 'Berger Paints (I) Limited', 'Bharat Forge Limited', 'Bharat Rasayan Limited', 'Bharti Airtel Limited', 'Bharat Heavy Electricals Limited', 'Biocon Limited', 'Birla Corporation Limited', 'Bliss GVS Pharma Limited', 'Blue Dart Express Limited', 'Blue Star Limited', 'Bosch Limited', 'Bharat Petroleum Corporation Limited', 'Brigade Enterprises Limited', 'Britannia Industries Limited', 'BSE Limited', 'BIRLASOFT LIMITED', 'Burger King India Limited', 'Cadila Healthcare Limited', 'Computer Age Management Services Limited', 'Canara Bank', 'Can Fin Homes Limited', 'Caplin Point Laboratories Limited', 'Carborundum Universal Limited', 'Castrol India Limited', 'CCL Products (India) Limited', 'Central Depository Services (India) Limited', 'CEAT Limited', 'Central Bank of India', 'Century Plyboards (India) Limited', 'Century Textiles & Industries Limited', 'Cera Sanitaryware Limited', 'CESC Limited', 'Capri Global Capital Limited', 'Chalet Hotels Limited', 'Chambal Fertilizers & Chemicals Limited', 'Cholamandalam Investment and Finance Company Limited', 'Cholamandalam Financial Holdings Limited', 'Cipla Limited', 'Coal India Limited', 'Cochin Shipyard Limited', 'Coforge Limited', 'Colgate Palmolive (India) Limited', 'Container Corporation of India Limited', 'Coromandel International Limited', 'CREDITACCESS GRAMEEN LIMITED', 'CRISIL Limited', 'Crompton Greaves Consumer Electricals Limited', 'CSB Bank Limited', 'City Union Bank Limited', 'Cummins India Limited', 'Cyient Limited', 'Dabur India Limited', 'Dalmia Bharat Limited', 'Dilip Buildcon Limited', 'Dishman Carbogen Amcis Limited', 'DCB Bank Limited', 'DCM Shriram Limited', 'Deepak Nitrite Limited', 'Delta Corp Limited', 'Dhani Services Limited', 'Dhanuka Agritech Limited', 'Dish TV India Limited', "Divi's Laboratories Limited", 'Dixon Technologies (India) Limited', 'DLF Limited', 'Avenue Supermarts Limited', "Dr. Reddy's Laboratories Limited", 'eClerx Services Limited', 'Edelweiss Financial Services Limited', 'Eicher Motors Limited', 'EID Parry India Limited', 'EIH Limited', 'Elgi Equipments Limited', 'Emami Limited', 'Endurance Technologies Limited', 'Engineers India Limited', 'EPL Limited', 'Equitas Holdings Limited', 'Eris Lifesciences Limited', 'Escorts Limited', 'Exide Industries Limited', 'Future Consumer Limited', 'FDC Limited', 'The Federal Bank  Limited', 'Finolex Cables Limited', 'Fine Organic Industries Limited', 'Finolex Industries Limited', 'Gujarat Fluorochemicals Limited', 'Fortis Healthcare Limited', 'Future Retail Limited', 'Firstsource Solutions Limited', 'Gujarat Ambuja Exports Limited', 'GAIL (India) Limited', 'Galaxy Surfactants Limited', 'Garware Technical Fibres Limited', 'GE Power India Limited', 'The Great Eastern Shipping Company Limited', 'General Insurance Corporation of India', 'Gillette India Limited', 'GlaxoSmithKline Pharmaceuticals Limited', 'Glenmark Pharmaceuticals Limited', 'GMM Pfaudler Limited', 'GMR Infrastructure Limited', 'Gujarat Narmada Valley Fertilizers and Chemicals Limited', 'Godfrey Phillips India Limited', 'Godrej Agrovet Limited', 'Godrej Consumer Products Limited', 'Godrej Industries Limited', 'Godrej Properties Limited', 'Gujarat Pipavav Port Limited', 'Granules India Limited', 'Graphite India Limited', 'Grasim Industries Limited', 'Greaves Cotton Limited', 'Grindwell Norton Limited', 'Garden Reach Shipbuilders & Engineers Limited', 'Gujarat State Fertilizers & Chemicals Limited', 'Gujarat State Petronet Limited', 'Gujarat Alkalies and Chemicals Limited', 'Gujarat Gas Limited', 'Gulf Oil Lubricants India Limited', 'Hindustan Aeronautics Limited', 'Happiest Minds Technologies Limited', 'Hatsun Agro Product Limited', 'Havells India Limited', 'HCL Technologies Limited', 'Housing Development Finance Corporation Limited', 'HDFC Asset Management Company Limited', 'HDFC Bank Limited', 'HDFC Life Insurance Company Limited', 'HEG Limited', 'HeidelbergCement India Limited', 'Hemisphere Properties India Limited', 'Hero MotoCorp Limited', 'HFCL Limited', 'Hindalco Industries Limited', 'Hindustan Copper Limited', 'Hindustan Petroleum Corporation Limited', 'Hindustan Unilever Limited', 'Hindustan Zinc Limited', 'Honeywell Automation India Limited', 'Himadri Speciality Chemical Limited', 'Housing & Urban Development Corporation Limited', 'Huhtamaki India Limited', 'Indiabulls Real Estate Limited', 'Indiabulls Housing Finance Limited', 'ICICI Bank Limited', 'ICICI Lombard General Insurance Company Limited', 'ICICI Prudential Life Insurance Company Limited', 'Indo Count Industries Limited', 'IDBI Bank Limited', 'Vodafone Idea Limited', 'IDFC Limited', 'IDFC First Bank Limited', 'Indian Energy Exchange Limited', 'IFB Industries Limited', 'Indraprastha Gas Limited', 'IIFL Finance Limited', 'Iifl Wealth Management Limited', 'The Indian Hotels Company Limited', 'The India Cements Limited', 'Indiamart Intermesh Limited', 'Indian Bank', 'InterGlobe Aviation Limited', 'Indoco Remedies Limited', 'IndusInd Bank Limited', 'Indus Towers Limited', 'Infibeam Avenues Limited', 'Infosys Limited', 'Ingersoll Rand (India) Limited', 'INOX Leisure Limited', 'Intellect Design Arena Limited', 'Indian Overseas Bank', 'Indian Oil Corporation Limited', 'IOL Chemicals and Pharmaceuticals Limited', 'IPCA Laboratories Limited', 'IRB Infrastructure Developers Limited', 'Ircon International Limited', 'Indian Railway Catering And Tourism Corporation Limited', 'ICICI Securities Limited', 'ITC Limited', 'ITI Limited', 'Jamna Auto Industries Limited', 'JB Chemicals & Pharmaceuticals Limited', 'Johnson Controls - Hitachi Air Conditioning India Limited', 'Jindal Saw Limited', 'Jindal Steel & Power Limited', 'JK Cement Limited', 'JK Lakshmi Cement Limited', 'JK Paper Limited', 'JK Tyre & Industries Limited', 'JM Financial Limited', 'Jindal Stainless Limited', 'Jindal Stainless (Hisar) Limited', 'JSW Energy Limited', 'JSW Steel Limited', 'Jtekt India Limited', 'Jubilant Foodworks Limited', 'Just Dial Limited', 'Jyothy Labs Limited', 'Kajaria Ceramics Limited', 'Kalpataru Power Transmission Limited', 'Kansai Nerolac Paints Limited', 'Karur Vysya Bank Limited', 'KEC International Limited', 'KEI Industries Limited', 'KNR Constructions Limited', 'Kotak Mahindra Bank Limited', 'KPIT Technologies Limited', 'K.P.R. Mill Limited', 'KRBL Limited', 'Ksb Limited', 'Kaveri Seed Company Limited', 'L&T Finance Holdings Limited', 'Dr. Lal Path Labs Ltd.', 'La Opala RG Limited', 'Laurus Labs Limited', 'Lakshmi Machine Works Limited', 'Lemon Tree Hotels Limited', 'LIC Housing Finance Limited', 'Linde India Limited', 'Larsen & Toubro Limited', 'Larsen & Toubro Infotech Limited', 'L&T Technology Services Limited', 'Lupin Limited', 'Lux Industries Limited', 'Mahindra & Mahindra Limited', 'Mahindra & Mahindra Financial Services Limited', 'Bank of Maharashtra', 'Mahindra CIE Automotive Limited', 'Mahindra Logistics Limited', 'Maharashtra Scooters Limited', 'Maharashtra Seamless Limited', 'Manappuram Finance Limited', 'Marico Limited', 'Maruti Suzuki India Limited', 'MAS Financial Services Limited', 'Max Healthcare Institute Limited', 'Mazagon Dock Shipbuilders Limited', 'United Spirits Limited', 'Multi Commodity Exchange of India Limited', 'Metropolis Healthcare Limited', 'Max Financial Services Limited', 'Mahanagar Gas Limited', 'Mahindra Holidays & Resorts India Limited', 'Mishra Dhatu Nigam Limited', 'Minda Corporation Limited', 'Minda Industries Limited', 'MindTree Limited', 'MMTC Limited', 'MOIL Limited', 'Motherson Sumi Systems Limited', 'Motilal Oswal Financial Services Limited', 'MphasiS Limited', 'MRF Limited', 'Mangalore Refinery and Petrochemicals Limited', 'Muthoot Finance Limited', 'Nippon Life India Asset Management Limited', 'Natco Pharma Limited', 'National Aluminium Company Limited', 'Info Edge (India) Limited', 'Navin Fluorine International Limited', 'NBCC (India) Limited', 'NCC Limited', 'Nesco Limited', 'Nestle India Limited', 'Network18 Media & Investments Limited', 'National Fertilizers Limited', 'Narayana Hrudayalaya Ltd.', 'NHPC Limited', 'The New India Assurance Company Limited', 'Nilkamal Limited', 'NLC India Limited', 'NMDC Limited', 'NOCIL Limited', 'NTPC Limited', 'Oberoi Realty Limited', 'Oracle Financial Services Software Limited', 'Oil India Limited', 'Oil & Natural Gas Corporation Limited', 'Orient Electric Limited', 'Orient Refractories Limited', 'Page Industries Limited', 'Piramal Enterprises Limited', 'Persistent Systems Limited', 'Petronet LNG Limited', 'Power Finance Corporation Limited', 'Pfizer Limited', 'Procter & Gamble Hygiene and Health Care Limited', 'Procter & Gamble Health Limited', 'Phillips Carbon Black Limited', 'The Phoenix Mills Limited', 'Pidilite Industries Limited', 'PI Industries Limited', 'Punjab National Bank', 'PNB Housing Finance Limited', 'PNC Infratech Limited', 'Polycab India Limited', 'Poly Medicure Limited', 'Polyplex Corporation Limited', 'Power Grid Corporation of India Limited', 'ABB Power Products and Systems India Limited', 'Prestige Estates Projects Limited', 'Prince Pipes And Fittings Limited', 'Prism Johnson Limited', 'PVR Limited', 'Quess Corp Limited', 'Radico Khaitan Limited', 'Rain Industries Limited', 'Rajesh Exports Limited', 'Rallis India Limited', 'The Ramco Cements Limited', 'Ratnamani Metals & Tubes Limited', 'Raymond Limited', 'RBL Bank Limited', 'Rashtriya Chemicals and Fertilizers Limited', 'REC Limited', 'Redington (India) Limited', 'Relaxo Footwears Limited', 'Reliance Industries Limited', 'Responsive Industries Limited', 'RITES Limited', 'Rossari Biotech Limited', 'ROUTE MOBILE LIMITED', 'Rail Vikas Nigam Limited', 'Steel Authority of India Limited', 'Sanofi India Limited', 'SBI Cards and Payment Services Limited', 'SBI Life Insurance Company Limited', 'State Bank of India', 'Schaeffler India Limited', 'Schneider Electric Infrastructure Limited', 'Shipping Corporation Of India Limited', 'Sequent Scientific Limited', 'Sheela Foam Limited', 'Sharda Cropchem Limited', 'Shilpa Medicare Limited', 'Shoppers Stop Limited', 'SHREE CEMENT LIMITED', 'Shriram City Union Finance Limited', 'Siemens Limited', 'SIS LIMITED', 'SJVN Limited', 'SKF India Limited', 'Sobha Limited', 'Solara Active Pharma Sciences Limited', 'Solar Industries India Limited', 'Sonata Software Limited', 'Spandana Sphoorty Financial Limited', 'Sun Pharma Advanced Research Company Limited', 'SPICEJET LTD', 'SRF Limited', 'Shriram Transport Finance Company Limited', 'Strides Pharma Science Limited', 'Star Cement Limited', 'Sterlite Technologies Limited', 'Sudarshan Chemical Industries Limited', 'Sumitomo Chemical India Limited', 'Sundaram Clayton Limited', 'Sundaram Finance Limited', 'Sundram Fasteners Limited', 'Sun Pharmaceutical Industries Limited', 'Sunteck Realty Limited', 'Sun TV Network Limited', 'Supreme Petrochem Limited', 'Suprajit Engineering Limited', 'Supreme Industries Limited', 'Suven Pharmaceuticals Limited', 'Suzlon Energy Limited', 'Swan Energy Limited', 'Sterling And Wilson Solar Limited', 'Symphony Limited', 'Syngene International Limited', 'Tanla Platforms Limited', 'Tasty Bite Eatables Limited', 'Tata Chemicals Limited', 'Tata Coffee Limited', 'Tata Communications Limited', 'TATA CONSUMER PRODUCTS LIMITED', 'Tata Elxsi Limited', 'Tata Investment Corporation Limited', 'Tata Motors Limited', 'Tata Motors Limited', 'Tata Power Company Limited', 'Tata Steel Limited', 'TCI Express Limited', 'TCNS Clothing Co. Limited', 'Tata Consultancy Services Limited', 'Teamlease Services Limited', 'Tech Mahindra Limited', 'Thermax Limited', 'Thyrocare Technologies Limited', 'Tube Investments of India Limited', 'Timken India Limited', 'Titan Company Limited', 'Torrent Pharmaceuticals Limited', 'Torrent Power Limited', 'Trent Limited', 'Trident Limited', 'Triveni Turbine Limited', 'TTK Prestige Limited', 'TV18 Broadcast Limited', 'TVS Motor Company Limited', 'United Breweries Limited', 'UCO Bank', 'UFLEX Limited', 'Ujjivan Financial Services Limited', 'Ujjivan Small Finance Bank Limited', 'UltraTech Cement Limited', 'Union Bank of India', 'UPL Limited', 'UTI Asset Management Company Limited', 'Vaibhav Global Limited', 'Vakrangee Limited', 'Valiant Organics Limited', 'Varroc Engineering Limited', 'Varun Beverages Limited', 'Vedanta Limited', "Venky's (India) Limited", 'V-Guard Industries Limited', 'Vinati Organics Limited', 'VIP Industries Limited', 'V-Mart Retail Limited', 'Voltas Limited', 'VST Industries Limited', 'Vardhman Textiles Limited', 'WABCO India Limited', 'Welspun Corp Limited', 'Welspun India Limited', 'Westlife Development Ltd', 'Whirlpool of India Limited', 'Wipro Limited', 'Wockhardt Limited', 'Yes Bank Limited', 'Zee Entertainment Enterprises Limited', 'Zensar Technologies Limited', 'Zydus Wellness Limited']
d500={'3M India Limited': '3MINDIA', 'Aarti Drugs Limited': 'AARTIDRUGS', 'Aarti Industries Limited': 'AARTIIND', 'Aavas Financiers Limited': 'AAVAS', 'ABB India Limited': 'ABB', 'Abbott India Limited': 'ABBOTINDIA', 'Aditya Birla Capital Limited': 'ABCAPITAL', 'Aditya Birla Fashion and Retail Limited': 'ABFRL', 'ACC Limited': 'ACC', 'Adani Enterprises Limited': 'ADANIENT', 'Adani Green Energy Limited': 'ADANIGREEN', 'Adani Ports and Special Economic Zone Limited': 'ADANIPORTS', 'Adani Transmission Limited': 'ADANITRANS', 'Advanced Enzyme Technologies Limited': 'ADVENZYMES', 'Aegis Logistics Limited': 'AEGISCHEM', 'Affle (India) Limited': 'AFFLE', 'AIA Engineering Limited': 'AIAENG', 'Ajanta Pharma Limited': 'AJANTPHARM', 'Akzo Nobel India Limited': 'AKZOINDIA', 'Alembic Limited': 'ALEMBICLTD', 'Alkem Laboratories Limited': 'ALKEM', 'Alkyl Amines Chemicals Limited': 'ALKYLAMINE', 'Alok Industries Limited': 'ALOKINDS', 'Amara Raja Batteries Limited': 'AMARAJABAT', 'Amber Enterprises India Limited': 'AMBER', 'Ambuja Cements Limited': 'AMBUJACEM', 'Angel Broking Limited': 'ANGELBRKG', 'APL Apollo Tubes Limited': 'APLAPOLLO', 'Alembic Pharmaceuticals Limited': 'APLLTD', 'Apollo Hospitals Enterprise Limited': 'APOLLOHOSP', 'Apollo Tyres Limited': 'APOLLOTYRE', 'Asahi India Glass Limited': 'ASAHIINDIA', 'Ashoka Buildcon Limited': 'ASHOKA', 'Ashok Leyland Limited': 'ASHOKLEY', 'Asian Paints Limited': 'ASIANPAINT', 'Aster DM Healthcare Limited': 'ASTERDM', 'Astral Poly Technik Limited': 'ASTRAL', 'AstraZeneca Pharma India Limited': 'ASTRAZEN', 'Adani Total Gas Limited': 'ATGL', 'Atul Limited': 'ATUL', 'AU Small Finance Bank Limited': 'AUBANK', 'Aurobindo Pharma Limited': 'AUROPHARMA', 'Avanti Feeds Limited': 'AVANTIFEED', 'Axis Bank Limited': 'AXISBANK', 'Bajaj Auto Limited': 'BAJAJ-AUTO', 'Bajaj Consumer Care Limited': 'BAJAJCON', 'Bajaj Electricals Limited': 'BAJAJELEC', 'Bajaj Finserv Limited': 'BAJAJFINSV', 'Bajaj Holdings & Investment Limited': 'BAJAJHLDNG', 'Bajaj Finance Limited': 'BAJFINANCE', 'Balaji Amines Limited': 'BALAMINES', 'Balkrishna Industries Limited': 'BALKRISIND', 'Balmer Lawrie & Company Limited': 'BALMLAWRIE', 'Balrampur Chini Mills Limited': 'BALRAMCHIN', 'Bandhan Bank Limited': 'BANDHANBNK', 'Bank of Baroda': 'BANKBARODA', 'Bank of India': 'BANKINDIA', 'BASF India Limited': 'BASF', 'Bata India Limited': 'BATAINDIA', 'Bayer Cropscience Limited': 'BAYERCROP', 'Bombay Burmah Trading Corporation Limited': 'BBTC', 'Bharat Dynamics Limited': 'BDL', 'Bharat Electronics Limited': 'BEL', 'BEML Limited': 'BEML', 'Berger Paints (I) Limited': 'BERGEPAINT', 'Bharat Forge Limited': 'BHARATFORG', 'Bharat Rasayan Limited': 'BHARATRAS', 'Bharti Airtel Limited': 'BHARTIARTL', 'Bharat Heavy Electricals Limited': 'BHEL', 'Biocon Limited': 'BIOCON', 'Birla Corporation Limited': 'BIRLACORPN', 'Bliss GVS Pharma Limited': 'BLISSGVS', 'Blue Dart Express Limited': 'BLUEDART', 'Blue Star Limited': 'BLUESTARCO', 'Bosch Limited': 'BOSCHLTD', 'Bharat Petroleum Corporation Limited': 'BPCL', 'Brigade Enterprises Limited': 'BRIGADE', 'Britannia Industries Limited': 'BRITANNIA', 'BSE Limited': 'BSE', 'BIRLASOFT LIMITED': 'BSOFT', 'Burger King India Limited': 'BURGERKING', 'Cadila Healthcare Limited': 'CADILAHC', 'Computer Age Management Services Limited': 'CAMS', 'Canara Bank': 'CANBK', 'Can Fin Homes Limited': 'CANFINHOME', 'Caplin Point Laboratories Limited': 'CAPLIPOINT', 'Carborundum Universal Limited': 'CARBORUNIV', 'Castrol India Limited': 'CASTROLIND', 'CCL Products (India) Limited': 'CCL', 'Central Depository Services (India) Limited': 'CDSL', 'CEAT Limited': 'CEATLTD', 'Central Bank of India': 'CENTRALBK', 'Century Plyboards (India) Limited': 'CENTURYPLY', 'Century Textiles & Industries Limited': 'CENTURYTEX', 'Cera Sanitaryware Limited': 'CERA', 'CESC Limited': 'CESC', 'Capri Global Capital Limited': 'CGCL', 'Chalet Hotels Limited': 'CHALET', 'Chambal Fertilizers & Chemicals Limited': 'CHAMBLFERT', 'Cholamandalam Investment and Finance Company Limited': 'CHOLAFIN', 'Cholamandalam Financial Holdings Limited': 'CHOLAHLDNG', 'Cipla Limited': 'CIPLA', 'Coal India Limited': 'COALINDIA', 'Cochin Shipyard Limited': 'COCHINSHIP', 'Coforge Limited': 'COFORGE', 'Colgate Palmolive (India) Limited': 'COLPAL', 'Container Corporation of India Limited': 'CONCOR', 'Coromandel International Limited': 'COROMANDEL', 'CREDITACCESS GRAMEEN LIMITED': 'CREDITACC', 'CRISIL Limited': 'CRISIL', 'Crompton Greaves Consumer Electricals Limited': 'CROMPTON', 'CSB Bank Limited': 'CSBBANK', 'City Union Bank Limited': 'CUB', 'Cummins India Limited': 'CUMMINSIND', 'Cyient Limited': 'CYIENT', 'Dabur India Limited': 'DABUR', 'Dalmia Bharat Limited': 'DALBHARAT', 'Dilip Buildcon Limited': 'DBL', 'Dishman Carbogen Amcis Limited': 'DCAL', 'DCB Bank Limited': 'DCBBANK', 'DCM Shriram Limited': 'DCMSHRIRAM', 'Deepak Nitrite Limited': 'DEEPAKNTR', 'Delta Corp Limited': 'DELTACORP', 'Dhani Services Limited': 'DHANI', 'Dhanuka Agritech Limited': 'DHANUKA', 'Dish TV India Limited': 'DISHTV', "Divi's Laboratories Limited": 'DIVISLAB', 'Dixon Technologies (India) Limited': 'DIXON', 'DLF Limited': 'DLF', 'Avenue Supermarts Limited': 'DMART', "Dr. Reddy's Laboratories Limited": 'DRREDDY', 'eClerx Services Limited': 'ECLERX', 'Edelweiss Financial Services Limited': 'EDELWEISS', 'Eicher Motors Limited': 'EICHERMOT', 'EID Parry India Limited': 'EIDPARRY', 'EIH Limited': 'EIHOTEL', 'Elgi Equipments Limited': 'ELGIEQUIP', 'Emami Limited': 'EMAMILTD', 'Endurance Technologies Limited': 'ENDURANCE', 'Engineers India Limited': 'ENGINERSIN', 'EPL Limited': 'EPL', 'Equitas Holdings Limited': 'EQUITAS', 'Eris Lifesciences Limited': 'ERIS', 'Escorts Limited': 'ESCORTS', 'Exide Industries Limited': 'EXIDEIND', 'Future Consumer Limited': 'FCONSUMER', 'FDC Limited': 'FDC', 'The Federal Bank  Limited': 'FEDERALBNK', 'Finolex Cables Limited': 'FINCABLES', 'Fine Organic Industries Limited': 'FINEORG', 'Finolex Industries Limited': 'FINPIPE', 'Gujarat Fluorochemicals Limited': 'FLUOROCHEM', 'Fortis Healthcare Limited': 'FORTIS', 'Future Retail Limited': 'FRETAIL', 'Firstsource Solutions Limited': 'FSL', 'Gujarat Ambuja Exports Limited': 'GAEL', 'GAIL (India) Limited': 'GAIL', 'Galaxy Surfactants Limited': 'GALAXYSURF', 'Garware Technical Fibres Limited': 'GARFIBRES', 'GE Power India Limited': 'GEPIL', 'The Great Eastern Shipping Company Limited': 'GESHIP', 'General Insurance Corporation of India': 'GICRE', 'Gillette India Limited': 'GILLETTE', 'GlaxoSmithKline Pharmaceuticals Limited': 'GLAXO', 'Glenmark Pharmaceuticals Limited': 'GLENMARK', 'GMM Pfaudler Limited': 'GMMPFAUDLR', 'GMR Infrastructure Limited': 'GMRINFRA', 'Gujarat Narmada Valley Fertilizers and Chemicals Limited': 'GNFC', 'Godfrey Phillips India Limited': 'GODFRYPHLP', 'Godrej Agrovet Limited': 'GODREJAGRO', 'Godrej Consumer Products Limited': 'GODREJCP', 'Godrej Industries Limited': 'GODREJIND', 'Godrej Properties Limited': 'GODREJPROP', 'Gujarat Pipavav Port Limited': 'GPPL', 'Granules India Limited': 'GRANULES', 'Graphite India Limited': 'GRAPHITE', 'Grasim Industries Limited': 'GRASIM', 'Greaves Cotton Limited': 'GREAVESCOT', 'Grindwell Norton Limited': 'GRINDWELL', 'Garden Reach Shipbuilders & Engineers Limited': 'GRSE', 'Gujarat State Fertilizers & Chemicals Limited': 'GSFC', 'Gujarat State Petronet Limited': 'GSPL', 'Gujarat Alkalies and Chemicals Limited': 'GUJALKALI', 'Gujarat Gas Limited': 'GUJGASLTD', 'Gulf Oil Lubricants India Limited': 'GULFOILLUB', 'Hindustan Aeronautics Limited': 'HAL', 'Happiest Minds Technologies Limited': 'HAPPSTMNDS', 'Hatsun Agro Product Limited': 'HATSUN', 'Havells India Limited': 'HAVELLS', 'HCL Technologies Limited': 'HCLTECH', 'Housing Development Finance Corporation Limited': 'HDFC', 'HDFC Asset Management Company Limited': 'HDFCAMC', 'HDFC Bank Limited': 'HDFCBANK', 'HDFC Life Insurance Company Limited': 'HDFCLIFE', 'HEG Limited': 'HEG', 'HeidelbergCement India Limited': 'HEIDELBERG', 'Hemisphere Properties India Limited': 'HEMIPROP', 'Hero MotoCorp Limited': 'HEROMOTOCO', 'HFCL Limited': 'HFCL', 'Hindalco Industries Limited': 'HINDALCO', 'Hindustan Copper Limited': 'HINDCOPPER', 'Hindustan Petroleum Corporation Limited': 'HINDPETRO', 'Hindustan Unilever Limited': 'HINDUNILVR', 'Hindustan Zinc Limited': 'HINDZINC', 'Honeywell Automation India Limited': 'HONAUT', 'Himadri Speciality Chemical Limited': 'HSCL', 'Housing & Urban Development Corporation Limited': 'HUDCO', 'Huhtamaki India Limited': 'HUHTAMAKI', 'Indiabulls Real Estate Limited': 'IBREALEST', 'Indiabulls Housing Finance Limited': 'IBULHSGFIN', 'ICICI Bank Limited': 'ICICIBANK', 'ICICI Lombard General Insurance Company Limited': 'ICICIGI', 'ICICI Prudential Life Insurance Company Limited': 'ICICIPRULI', 'Indo Count Industries Limited': 'ICIL', 'IDBI Bank Limited': 'IDBI', 'Vodafone Idea Limited': 'IDEA', 'IDFC Limited': 'IDFC', 'IDFC First Bank Limited': 'IDFCFIRSTB', 'Indian Energy Exchange Limited': 'IEX', 'IFB Industries Limited': 'IFBIND', 'Indraprastha Gas Limited': 'IGL', 'IIFL Finance Limited': 'IIFL', 'Iifl Wealth Management Limited': 'IIFLWAM', 'The Indian Hotels Company Limited': 'INDHOTEL', 'The India Cements Limited': 'INDIACEM', 'Indiamart Intermesh Limited': 'INDIAMART', 'Indian Bank': 'INDIANB', 'InterGlobe Aviation Limited': 'INDIGO', 'Indoco Remedies Limited': 'INDOCO', 'IndusInd Bank Limited': 'INDUSINDBK', 'Indus Towers Limited': 'INDUSTOWER', 'Infibeam Avenues Limited': 'INFIBEAM', 'Infosys Limited': 'INFY', 'Ingersoll Rand (India) Limited': 'INGERRAND', 'INOX Leisure Limited': 'INOXLEISUR', 'Intellect Design Arena Limited': 'INTELLECT', 'Indian Overseas Bank': 'IOB', 'Indian Oil Corporation Limited': 'IOC', 'IOL Chemicals and Pharmaceuticals Limited': 'IOLCP', 'IPCA Laboratories Limited': 'IPCALAB', 'IRB Infrastructure Developers Limited': 'IRB', 'Ircon International Limited': 'IRCON', 'Indian Railway Catering And Tourism Corporation Limited': 'IRCTC', 'ICICI Securities Limited': 'ISEC', 'ITC Limited': 'ITC', 'ITI Limited': 'ITI', 'Jamna Auto Industries Limited': 'JAMNAAUTO', 'JB Chemicals & Pharmaceuticals Limited': 'JBCHEPHARM', 'Johnson Controls - Hitachi Air Conditioning India Limited': 'JCHAC', 'Jindal Saw Limited': 'JINDALSAW', 'Jindal Steel & Power Limited': 'JINDALSTEL', 'JK Cement Limited': 'JKCEMENT', 'JK Lakshmi Cement Limited': 'JKLAKSHMI', 'JK Paper Limited': 'JKPAPER', 'JK Tyre & Industries Limited': 'JKTYRE', 'JM Financial Limited': 'JMFINANCIL', 'Jindal Stainless Limited': 'JSL', 'Jindal Stainless (Hisar) Limited': 'JSLHISAR', 'JSW Energy Limited': 'JSWENERGY', 'JSW Steel Limited': 'JSWSTEEL', 'Jtekt India Limited': 'JTEKTINDIA', 'Jubilant Foodworks Limited': 'JUBLFOOD', 'Just Dial Limited': 'JUSTDIAL', 'Jyothy Labs Limited': 'JYOTHYLAB', 'Kajaria Ceramics Limited': 'KAJARIACER', 'Kalpataru Power Transmission Limited': 'KALPATPOWR', 'Kansai Nerolac Paints Limited': 'KANSAINER', 'Karur Vysya Bank Limited': 'KARURVYSYA', 'KEC International Limited': 'KEC', 'KEI Industries Limited': 'KEI', 'KNR Constructions Limited': 'KNRCON', 'Kotak Mahindra Bank Limited': 'KOTAKBANK', 'KPIT Technologies Limited': 'KPITTECH', 'K.P.R. Mill Limited': 'KPRMILL', 'KRBL Limited': 'KRBL', 'Ksb Limited': 'KSB', 'Kaveri Seed Company Limited': 'KSCL', 'L&T Finance Holdings Limited': 'L&TFH', 'Dr. Lal Path Labs Ltd.': 'LALPATHLAB', 'La Opala RG Limited': 'LAOPALA', 'Laurus Labs Limited': 'LAURUSLABS', 'Lakshmi Machine Works Limited': 'LAXMIMACH', 'Lemon Tree Hotels Limited': 'LEMONTREE', 'LIC Housing Finance Limited': 'LICHSGFIN', 'Linde India Limited': 'LINDEINDIA', 'Larsen & Toubro Limited': 'LT', 'Larsen & Toubro Infotech Limited': 'LTI', 'L&T Technology Services Limited': 'LTTS', 'Lupin Limited': 'LUPIN', 'Lux Industries Limited': 'LUXIND', 'Mahindra & Mahindra Limited': 'M&M', 'Mahindra & Mahindra Financial Services Limited': 'M&MFIN', 'Bank of Maharashtra': 'MAHABANK', 'Mahindra CIE Automotive Limited': 'MAHINDCIE', 'Mahindra Logistics Limited': 'MAHLOG', 'Maharashtra Scooters Limited': 'MAHSCOOTER', 'Maharashtra Seamless Limited': 'MAHSEAMLES', 'Manappuram Finance Limited': 'MANAPPURAM', 'Marico Limited': 'MARICO', 'Maruti Suzuki India Limited': 'MARUTI', 'MAS Financial Services Limited': 'MASFIN', 'Max Healthcare Institute Limited': 'MAXHEALTH', 'Mazagon Dock Shipbuilders Limited': 'MAZDOCK', 'United Spirits Limited': 'MCDOWELL-N', 'Multi Commodity Exchange of India Limited': 'MCX', 'Metropolis Healthcare Limited': 'METROPOLIS', 'Max Financial Services Limited': 'MFSL', 'Mahanagar Gas Limited': 'MGL', 'Mahindra Holidays & Resorts India Limited': 'MHRIL', 'Mishra Dhatu Nigam Limited': 'MIDHANI', 'Minda Corporation Limited': 'MINDACORP', 'Minda Industries Limited': 'MINDAIND', 'MindTree Limited': 'MINDTREE', 'MMTC Limited': 'MMTC', 'MOIL Limited': 'MOIL', 'Motherson Sumi Systems Limited': 'MOTHERSUMI', 'Motilal Oswal Financial Services Limited': 'MOTILALOFS', 'MphasiS Limited': 'MPHASIS', 'MRF Limited': 'MRF', 'Mangalore Refinery and Petrochemicals Limited': 'MRPL', 'Muthoot Finance Limited': 'MUTHOOTFIN', 'Nippon Life India Asset Management Limited': 'NAM-INDIA', 'Natco Pharma Limited': 'NATCOPHARM', 'National Aluminium Company Limited': 'NATIONALUM', 'Info Edge (India) Limited': 'NAUKRI', 'Navin Fluorine International Limited': 'NAVINFLUOR', 'NBCC (India) Limited': 'NBCC', 'NCC Limited': 'NCC', 'Nesco Limited': 'NESCO', 'Nestle India Limited': 'NESTLEIND', 'Network18 Media & Investments Limited': 'NETWORK18', 'National Fertilizers Limited': 'NFL', 'Narayana Hrudayalaya Ltd.': 'NH', 'NHPC Limited': 'NHPC', 'The New India Assurance Company Limited': 'NIACL', 'Nilkamal Limited': 'NILKAMAL', 'NLC India Limited': 'NLCINDIA', 'NMDC Limited': 'NMDC', 'NOCIL Limited': 'NOCIL', 'NTPC Limited': 'NTPC', 'Oberoi Realty Limited': 'OBEROIRLTY', 'Oracle Financial Services Software Limited': 'OFSS', 'Oil India Limited': 'OIL', 'Oil & Natural Gas Corporation Limited': 'ONGC', 'Orient Electric Limited': 'ORIENTELEC', 'Orient Refractories Limited': 'ORIENTREF', 'Page Industries Limited': 'PAGEIND', 'Piramal Enterprises Limited': 'PEL', 'Persistent Systems Limited': 'PERSISTENT', 'Petronet LNG Limited': 'PETRONET', 'Power Finance Corporation Limited': 'PFC', 'Pfizer Limited': 'PFIZER', 'Procter & Gamble Hygiene and Health Care Limited': 'PGHH', 'Procter & Gamble Health Limited': 'PGHL', 'Phillips Carbon Black Limited': 'PHILIPCARB', 'The Phoenix Mills Limited': 'PHOENIXLTD', 'Pidilite Industries Limited': 'PIDILITIND', 'PI Industries Limited': 'PIIND', 'Punjab National Bank': 'PNB', 'PNB Housing Finance Limited': 'PNBHOUSING', 'PNC Infratech Limited': 'PNCINFRA', 'Polycab India Limited': 'POLYCAB', 'Poly Medicure Limited': 'POLYMED', 'Polyplex Corporation Limited': 'POLYPLEX', 'Power Grid Corporation of India Limited': 'POWERGRID', 'ABB Power Products and Systems India Limited': 'POWERINDIA', 'Prestige Estates Projects Limited': 'PRESTIGE', 'Prince Pipes And Fittings Limited': 'PRINCEPIPE', 'Prism Johnson Limited': 'PRSMJOHNSN', 'PVR Limited': 'PVR', 'Quess Corp Limited': 'QUESS', 'Radico Khaitan Limited': 'RADICO', 'Rain Industries Limited': 'RAIN', 'Rajesh Exports Limited': 'RAJESHEXPO', 'Rallis India Limited': 'RALLIS', 'The Ramco Cements Limited': 'RAMCOCEM', 'Ratnamani Metals & Tubes Limited': 'RATNAMANI', 'Raymond Limited': 'RAYMOND', 'RBL Bank Limited': 'RBLBANK', 'Rashtriya Chemicals and Fertilizers Limited': 'RCF', 'REC Limited': 'RECLTD', 'Redington (India) Limited': 'REDINGTON', 'Relaxo Footwears Limited': 'RELAXO', 'Reliance Industries Limited': 'RELIANCE', 'Responsive Industries Limited': 'RESPONIND', 'RITES Limited': 'RITES', 'Rossari Biotech Limited': 'ROSSARI', 'ROUTE MOBILE LIMITED': 'ROUTE', 'Rail Vikas Nigam Limited': 'RVNL', 'Steel Authority of India Limited': 'SAIL', 'Sanofi India Limited': 'SANOFI', 'SBI Cards and Payment Services Limited': 'SBICARD', 'SBI Life Insurance Company Limited': 'SBILIFE', 'State Bank of India': 'SBIN', 'Schaeffler India Limited': 'SCHAEFFLER', 'Schneider Electric Infrastructure Limited': 'SCHNEIDER', 'Shipping Corporation Of India Limited': 'SCI', 'Sequent Scientific Limited': 'SEQUENT', 'Sheela Foam Limited': 'SFL', 'Sharda Cropchem Limited': 'SHARDACROP', 'Shilpa Medicare Limited': 'SHILPAMED', 'Shoppers Stop Limited': 'SHOPERSTOP', 'SHREE CEMENT LIMITED': 'SHREECEM', 'Shriram City Union Finance Limited': 'SHRIRAMCIT', 'Siemens Limited': 'SIEMENS', 'SIS LIMITED': 'SIS', 'SJVN Limited': 'SJVN', 'SKF India Limited': 'SKFINDIA', 'Sobha Limited': 'SOBHA', 'Solara Active Pharma Sciences Limited': 'SOLARA', 'Solar Industries India Limited': 'SOLARINDS', 'Sonata Software Limited': 'SONATSOFTW', 'Spandana Sphoorty Financial Limited': 'SPANDANA', 'Sun Pharma Advanced Research Company Limited': 'SPARC', 'SPICEJET LTD': 'SPICEJET', 'SRF Limited': 'SRF', 'Shriram Transport Finance Company Limited': 'SRTRANSFIN', 'Strides Pharma Science Limited': 'STAR', 'Star Cement Limited': 'STARCEMENT', 'Sterlite Technologies Limited': 'STLTECH', 'Sudarshan Chemical Industries Limited': 'SUDARSCHEM', 'Sumitomo Chemical India Limited': 'SUMICHEM', 'Sundaram Clayton Limited': 'SUNCLAYLTD', 'Sundaram Finance Limited': 'SUNDARMFIN', 'Sundram Fasteners Limited': 'SUNDRMFAST', 'Sun Pharmaceutical Industries Limited': 'SUNPHARMA', 'Sunteck Realty Limited': 'SUNTECK', 'Sun TV Network Limited': 'SUNTV', 'Supreme Petrochem Limited': 'SUPPETRO', 'Suprajit Engineering Limited': 'SUPRAJIT', 'Supreme Industries Limited': 'SUPREMEIND', 'Suven Pharmaceuticals Limited': 'SUVENPHAR', 'Suzlon Energy Limited': 'SUZLON', 'Swan Energy Limited': 'SWANENERGY', 'Sterling And Wilson Solar Limited': 'SWSOLAR', 'Symphony Limited': 'SYMPHONY', 'Syngene International Limited': 'SYNGENE', 'Tanla Platforms Limited': 'TANLA', 'Tasty Bite Eatables Limited': 'TASTYBITE', 'Tata Chemicals Limited': 'TATACHEM', 'Tata Coffee Limited': 'TATACOFFEE', 'Tata Communications Limited': 'TATACOMM', 'TATA CONSUMER PRODUCTS LIMITED': 'TATACONSUM', 'Tata Elxsi Limited': 'TATAELXSI', 'Tata Investment Corporation Limited': 'TATAINVEST', 'Tata Motors Limited': 'TATAMTRDVR', 'Tata Power Company Limited': 'TATAPOWER', 'Tata Steel Limited': 'TATASTEEL', 'TCI Express Limited': 'TCIEXP', 'TCNS Clothing Co. Limited': 'TCNSBRANDS', 'Tata Consultancy Services Limited': 'TCS', 'Teamlease Services Limited': 'TEAMLEASE', 'Tech Mahindra Limited': 'TECHM', 'Thermax Limited': 'THERMAX', 'Thyrocare Technologies Limited': 'THYROCARE', 'Tube Investments of India Limited': 'TIINDIA', 'Timken India Limited': 'TIMKEN', 'Titan Company Limited': 'TITAN', 'Torrent Pharmaceuticals Limited': 'TORNTPHARM', 'Torrent Power Limited': 'TORNTPOWER', 'Trent Limited': 'TRENT', 'Trident Limited': 'TRIDENT', 'Triveni Turbine Limited': 'TRITURBINE', 'TTK Prestige Limited': 'TTKPRESTIG', 'TV18 Broadcast Limited': 'TV18BRDCST', 'TVS Motor Company Limited': 'TVSMOTOR', 'United Breweries Limited': 'UBL', 'UCO Bank': 'UCOBANK', 'UFLEX Limited': 'UFLEX', 'Ujjivan Financial Services Limited': 'UJJIVAN', 'Ujjivan Small Finance Bank Limited': 'UJJIVANSFB', 'UltraTech Cement Limited': 'ULTRACEMCO', 'Union Bank of India': 'UNIONBANK', 'UPL Limited': 'UPL', 'UTI Asset Management Company Limited': 'UTIAMC', 'Vaibhav Global Limited': 'VAIBHAVGBL', 'Vakrangee Limited': 'VAKRANGEE', 'Valiant Organics Limited': 'VALIANTORG', 'Varroc Engineering Limited': 'VARROC', 'Varun Beverages Limited': 'VBL', 'Vedanta Limited': 'VEDL', "Venky's (India) Limited": 'VENKEYS', 'V-Guard Industries Limited': 'VGUARD', 'Vinati Organics Limited': 'VINATIORGA', 'VIP Industries Limited': 'VIPIND', 'V-Mart Retail Limited': 'VMART', 'Voltas Limited': 'VOLTAS', 'VST Industries Limited': 'VSTIND', 'Vardhman Textiles Limited': 'VTL', 'WABCO India Limited': 'WABCOINDIA', 'Welspun Corp Limited': 'WELCORP', 'Welspun India Limited': 'WELSPUNIND', 'Westlife Development Ltd': 'WESTLIFE', 'Whirlpool of India Limited': 'WHIRLPOOL', 'Wipro Limited': 'WIPRO', 'Wockhardt Limited': 'WOCKPHARMA', 'Yes Bank Limited': 'YESBANK', 'Zee Entertainment Enterprises Limited': 'ZEEL', 'Zensar Technologies Limited': 'ZENSARTECH', 'Zydus Wellness Limited': 'ZYDUSWELL'}
charts=["ochl","vol","macd","rsi","adx","squeeze","ichi","elliot"]
dataframe=None
charttype=None
fname=None
def get_data(name,index=False):
    dat = nsepy.get_history(symbol=name,
                      start=dt - datetime.timedelta(1000),
                      end=dt,index=index)
    return dat

@app.route('/', methods=['GET', 'POST'])
def notdash():
    global dataframe,charttype
    if request.method == 'POST':
        print("got request",request.form)
        if request.form["image"]:
            print(request.form["image"])
            dataframe=d500[request.form["image"]]
        if request.form["charts"]:
            print(request.form["charts"])
            charttype=request.form["charts"]
        if dataframe and charttype:
            print(dataframe,charttype)
            print("rendering")
            fig=render_charts(get_data(dataframe),charttype)
            if fig:
                print("converting")
                div = io.to_html(fig, include_plotlyjs=False)
                return render_template("home.html",dept=nifty_companies,charts=charts,code=div,error=f"successful {charttype}-{request.form['image']}")
            else:
                print("rejected",fig)
    return render_template("home.html",dept=nifty_companies,charts=charts,error="choose company and chart type")
@app.route('/fundamental', methods=['GET', 'POST'])
def fundamental():
    global fname
    if request.method == 'POST':
        if request.form["fname"]:
            fname=request.form["fname"]
        if fname:
            try:
                fig=getfundamental(d500[fname])
                div = io.to_html(fig, include_plotlyjs=False)
                return render_template("fundamental.html",dept=nifty_companies,code=div)
            except:
                return render_template("fundamental.html", dept=nifty_companies,error="unable to retrieve data")
    return render_template("fundamental.html",dept=nifty_companies)

if __name__ == "__main__":
    app.run()
# print(help(io))

